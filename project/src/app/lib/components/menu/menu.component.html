<nav 
  class="menu"
  [class.vertical]="mode() === 'vertical'"
  [class.horizontal]="mode() === 'horizontal'"
  [class.compact]="variant() === 'compact'"
  [class.expanded]="variant() === 'expanded'"
  [class.collapsed]="collapsed()"
  role="navigation"
  [attr.aria-label]="'Navigation menu'"
  [attr.data-state]="state()"
>
  @if (collapsible()) {
    <button 
      class="menu-collapse-button"
      (click)="toggleCollapse()"
      [attr.aria-expanded]="!collapsed()"
      [attr.aria-label]="collapsed() ? ariaLabels()['expand'] : ariaLabels()['collapse']"
    >
      <i class="ph ph-caret-left" aria-hidden="true"></i>
    </button>
  }

  <ul class="menu-list" role="menubar">
    @for (item of items(); track item.id) {
      @if (item.divider) {
        <li class="menu-divider" role="separator"></li>
      } @else {
        <li 
          class="menu-item"
          [class.has-children]="item.children?.length"
          [class.expanded]="isExpanded(item)"
          [class.disabled]="item.disabled"
          role="none"
        >
          <a
            class="menu-link"
            [routerLink]="item.path"
            [routerLinkActive]="'active'"
            [class.active]="item.active"
            [attr.aria-disabled]="item.disabled"
            [attr.aria-expanded]="item.children?.length ? isExpanded(item) : null"
            [attr.aria-label]="getAriaLabel(item)"
            (click)="toggleItem(item, $event)"
            role="menuitem"
            [attr.tabindex]="item.disabled ? -1 : 0"
          >
            @if (item.icon) {
              <i class="ph ph-{{ item.icon }}" aria-hidden="true"></i>
            }
            
            @if (!collapsed() || mode() === 'horizontal') {
              <span class="menu-label">{{ item.content }}</span>
            }

            @if (item.badge) {
              <span class="menu-badge" role="status">{{ item.badge }}</span>
            }

            @if (item.children?.length) {
              <i 
                class="ph ph-caret-down menu-arrow"
                [class.expanded]="isExpanded(item)"
                aria-hidden="true"
              ></i>
            }
          </a>

          @if (item.children?.length) {
            <ul 
              class="submenu" 
              role="menu" 
              [attr.aria-label]="item.content + ' submenu'"
            >
              @for (child of item.children; track child.id) {
                <li class="menu-item" role="none">
                  <a
                    class="menu-link"
                    [routerLink]="child.path"
                    [routerLinkActive]="'active'"
                    [class.active]="child.active"
                    [attr.aria-disabled]="child.disabled"
                    [attr.aria-label]="getAriaLabel(child)"
                    (click)="toggleItem(child, $event)"
                    role="menuitem"
                    [attr.tabindex]="child.disabled ? -1 : 0"
                  >
                    @if (child.icon) {
                      <i class="ph ph-{{ child.icon }}" aria-hidden="true"></i>
                    }
                    <span class="menu-label">{{ child.content }}</span>
                    @if (child.badge) {
                      <span class="menu-badge" role="status">{{ child.badge }}</span>
                    }
                  </a>
                </li>
              }
            </ul>
          }
        </li>
      }
    }
  </ul>
</nav>